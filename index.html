<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintonia App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --background-dark: #1a1a2e;
            --background-light: #f0f0f0;
            --card-dark: #16213e;
            --card-light: #ffffff;
            --text-dark: #e9e4f0;
            --text-light: #333333;
            --accent-blue: #007bff;
            --hover-blue: #0056b3;
            --shadow-dark: rgba(0, 0, 0, 0.5);
            --shadow-light: rgba(0, 0, 0, 0.1);
            --border-radius: 15px;
            --padding: 20px;
            --transition-speed: 0.3s;
            --gradient-start-dark: #0f1626;
            --gradient-end-dark: #1a2a40;
            --gradient-start-light: #e0e0e0;
            --gradient-end-light: #f8f8f8;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--background-dark);
            color: var(--text-dark);
            transition: background-color var(--transition-speed), color var(--transition-speed);
            overflow-x: hidden;
            padding-bottom: 40px;
        }

        .container {
            background-color: var(--card-dark);
            padding: var(--padding);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px var(--shadow-dark);
            text-align: center;
            width: 95%;
            max-width: 600px;
            transition: background-color var(--transition-speed), box-shadow var(--transition-speed);
            position: relative;
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            color: var(--text-dark);
            font-size: 1.5em;
            cursor: pointer;
            transition: color var(--transition-speed);
            width: 44px;
            height: 44px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .theme-toggle:hover {
            color: var(--accent-blue);
        }

        /* Explicitly set font-size, width, height, and display for icons within the theme toggle */
        .theme-toggle i {
             font-size: 1em; /* Ensure icon takes the size of its parent button */
             width: 1em; /* Force width */
             height: 1em; /* Force height */
             display: inline-flex; /* Use flex to center content */
             align-items: center; /* Center vertically */
             justify-content: center; /* Center horizontally */
        }


        .visualizer-container {
            position: relative;
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
            margin-bottom: 20px;
            overflow: hidden;
        }

        #visualizerCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        #sintonia-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-dark);
            font-size: 1.5em;
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            transition: color var(--transition-speed);
            animation: color-pulse 4s infinite alternate;
        }

        @keyframes color-pulse {
            0% { color: var(--accent-blue); }
            50% { color: hsl(180, 100%, 70%); }
            100% { color: hsl(240, 100%, 70%); }
        }

         body.light-theme #sintonia-text {
             color: var(--text-light);
             animation: none;
         }

        #sintonia-text span {
            color: #ffffff;
            text-shadow: 0 0 8px var(--accent-blue);
            font-size: 1.1em;
            font-weight: bolder;
            animation: highlight-pulse 2s infinite alternate;
        }

        @keyframes highlight-pulse {
             0% { text-shadow: 0 0 8px var(--accent-blue); }
             100% { text-shadow: 0 0 12px var(--hover-blue); }
        }

        #rds-info {
            margin-top: 10px;
            font-size: 1.1em;
            min-height: 1.2em;
            transition: color var(--transition-speed);
        }

         body.light-theme #rds-info {
             color: var(--text-light);
         }

        #info-ticker {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(0, 123, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 123, 255, 0.2);
            color: var(--text-dark);
            font-size: 1em;
            min-height: 1.2em;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            transition: opacity 0.5s ease-in-out;
            text-align: center;
        }

         body.light-theme #info-ticker {
             background-color: rgba(0, 123, 255, 0.05);
             border: 1px solid rgba(0, 123, 255, 0.1);
             color: var(--text-light);
         }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .control-button {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 2em;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px var(--shadow-dark);
        }

        .control-button:hover {
            background-color: var(--hover-blue);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow-dark);
        }

        .control-button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px var(--shadow-dark);
        }

        /* Explicitly set font-size, width, height, and display for icons within control buttons */
        .control-button i {
             font-size: 1em; /* Ensure icon takes the size of its parent button */
             width: 1em; /* Force width */
             height: 1em; /* Force height */
             display: inline-flex; /* Use flex to center content */
             align-items: center; /* Center vertically */
             justify-content: center; /* Center horizontally */
        }


        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .volume-control input[type="range"] {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 10px;
            background: linear-gradient(to right, var(--gradient-start-dark), var(--gradient-end-dark));
            outline: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: background var(--transition-speed), box-shadow var(--transition-speed);
             border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent-blue);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 3px 8px var(--shadow-dark);
            transition: background-color var(--transition-speed), box-shadow var(--transition-speed), transform 0.1s ease-in-out;
             border: 2px solid white;
        }

        .volume-control input[type="range"]::-webkit-slider-thumb:hover {
            background-color: var(--hover-blue);
            box-shadow: 0 4px 10px var(--shadow-dark);
             transform: scale(1.1);
        }

         .volume-control input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(0.95);
             box-shadow: 0 2px 6px var(--shadow-dark);
         }

        .volume-control input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--accent-blue);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 3px 8px var(--shadow-dark);
            transition: background-color var(--transition-speed), box-shadow var(--transition-speed), transform 0.1s ease-in-out;
             border: 2px solid white;
        }

        .volume-control input[type="range"]::-moz-range-thumb:hover {
            background-color: var(--hover-blue);
            box-shadow: 0 4px 10px var(--shadow-dark);
             transform: scale(1.1);
        }

         .volume-control input[type="range"]::-moz-range-thumb:active {
            transform: scale(0.95);
             box-shadow: 0 2px 6px var(--shadow-dark);
         }

        .volume-control .fas { /* Use fas for volume icons */
            font-size: 1.5em;
            cursor: pointer;
            transition: color var(--transition-speed);
        }

        .volume-control .fas:hover {
            color: var(--accent-blue);
        }

        .station-select {
            margin-bottom: 20px;
        }

        .station-select label {
            margin-right: 10px;
            font-size: 1.1em;
        }

        .station-select select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--accent-blue);
            background-color: var(--card-dark);
            color: var(--text-dark);
            font-size: 1em;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
        }

        .station-select select:focus {
            outline: none;
            border-color: var(--hover-blue);
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        #sleepTimerControls {
            display: none;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .sleep-timer-toggle-button {
             background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 3px 10px var(--shadow-dark);
            margin-bottom: 20px;
        }

         .sleep-timer-toggle-button:hover {
            background-color: var(--hover-blue);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-dark);
         }

         .sleep-timer-toggle-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px var(--shadow-dark);
         }

         /* Explicitly set font-size, width, height, and display for icons within sleep timer toggle button */
         .sleep-timer-toggle-button i {
             font-size: 1em; /* Ensure icon takes the size of its parent button */
             width: 1em; /* Force width */
             height: 1em; /* Force height */
             display: inline-flex; /* Use flex to center content */
             align-items: center; /* Center vertically */
             justify-content: center; /* Center horizontally */
         }


        #sleepTimerControls label {
            margin-right: 0;
        }

        #sleepTimerControls input[type="number"] {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--accent-blue);
            background-color: var(--card-dark);
            color: var(--text-dark);
            width: 60px;
            text-align: center;
        }

        #sleepTimerControls button {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 5px;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 3px 10px var(--shadow-dark);
            padding: 0;
        }

        #sleepTimerControls button:hover {
            background-color: var(--hover-blue);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-dark);
        }

        #sleepTimerControls button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px var(--shadow-dark);
         }

         /* Explicitly set font-size, width, height, and display for icons within sleep timer control buttons */
         #sleepTimerControls button i {
             font-size: 1em; /* Ensure icon takes the size of its parent button */
             width: 1em; /* Force width */
             height: 1em; /* Force height */
             display: inline-flex; /* Use flex to center content */
             align-items: center; /* Center vertically */
             justify-content: center; /* Center horizontally */
         }


        #weeklySchedulerControls {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 123, 255, 0.3);
        }

        #weeklySchedulerControls h3 {
            color: var(--accent-blue);
            margin-bottom: 10px;
        }

        .day-select {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .day-select label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .time-select {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-select input[type="time"] {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--accent-blue);
            background-color: var(--card-dark);
            color: var(--text-dark);
            font-size: 1em;
            cursor: pointer;
        }

        #weeklySchedulerControls button {
             padding: 8px 15px;
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
            font-size: 1em;
        }

         #weeklySchedulerControls button:hover {
             background-color: var(--hover-blue);
         }

         /* Explicitly set font-size, width, height, and display for icons within weekly scheduler buttons */
         #weeklySchedulerControls button i {
             font-size: 1em; /* Ensure icon takes the size of its parent button */
             width: 1em; /* Force width */
             height: 1em; /* Force height */
             display: inline-flex; /* Use flex to center content */
             align-items: center; /* Center vertically */
             justify-content: center; /* Center horizontally */
             margin-right: 5px; /* Add a little space between icon and text */
         }


        .kick-embed-container {
            display: none;
            margin-top: 20px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 5px 15px var(--shadow-dark);
        }

        .kick-embed-container iframe {
            width: 100%;
            height: 400px;
            display: block;
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .toast {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .toast.show {
            opacity: 1;
        }

        body.light-theme {
            background-color: var(--background-light);
            color: var(--text-light);
        }

        .light-theme .container {
            background-color: var(--card-light);
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .light-theme .theme-toggle {
            color: var(--text-light);
        }

        .light-theme .theme-toggle:hover {
            color: var(--hover-blue);
        }

        .light-theme .volume-control input[type="range"] {
             background: linear-gradient(to right, var(--gradient-start-light), var(--gradient-end-light));
             box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
             border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .light-theme .volume-control input[type="range"]::-webkit-slider-thumb {
             background: var(--accent-blue);
             box-shadow: 0 3px 8px var(--shadow-light);
             border: 2px solid var(--text-light);
        }

         .light-theme .volume-control input[type="range"]::-webkit-slider-thumb:hover {
             background-color: var(--hover-blue);
             box-shadow: 0 4px 10px var(--shadow-light);
         }

         .light-theme .volume-control input[type="range"]::-webkit-slider-thumb:active {
             box-shadow: 0 2px 6px var(--shadow-light);
         }

        .light-theme .volume-control input[type="range"]::-moz-range-thumb {
             background: var(--accent-blue);
             box-shadow: 0 3px 8px var(--shadow-light);
             border: 2px solid var(--text-light);
        }

         .light-theme .volume-control input[type="range"]::-moz-range-thumb:hover {
             background-color: var(--hover-blue);
             box-shadow: 0 4px 10px var(--shadow-light);
         }

         .light-theme .volume-control input[type="range"]::-moz-range-thumb:active {
             box-shadow: 0 2px 6px var(--shadow-light);
         }

         .light-theme .station-select select,
         .light-theme #sleepTimerControls input[type="number"],
         .light-theme #weeklySchedulerControls input[type="time"] {
            background-color: var(--card-light);
            color: var(--text-light);
            border-color: var(--hover-blue);
         }

         .light-theme .kick-embed-container {
             box-shadow: 5px 5px 15px var(--shadow-light);
         }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                width: 98%;
            }

            .control-button {
                width: 50px;
                height: 50px;
                font-size: 1.8em;
            }

            .controls {
                gap: 15px;
            }

            .volume-control, .station-select {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .volume-control input[type="range"] {
                width: 80%;
            }
             .station-select select {
                 width: 80%;
                 box-sizing: border-box;
             }

             #sleepTimerControls {
                 flex-direction: column;
                 align-items: center;
                 gap: 10px;
             }

             #sleepTimerControls input[type="number"],
             #sleepTimerControls button {
                 width: 80%;
                 box-sizing: border-box;
             }

             #weeklySchedulerControls {
                 gap: 10px;
             }

             .day-select {
                 flex-direction: column;
                 gap: 5px;
             }

             .time-select {
                 flex-direction: column;
                 gap: 5px;
             }

             #weeklySchedulerControls button {
                 width: 80%;
                 box-sizing: border-box;
             }

             #sintonia-text {
                 font-size: 1.2em;
             }
        }

        .footer {
            margin-top: 20px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            width: 100%;
            padding: 10px 0;
        }

        body.light-theme .footer {
            color: rgba(51, 51, 51, 0.6);
        }

    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-12CV0B45ZB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-12CV0B45ZB');
    </script>
</head>
<body>
    <div class="container">
        <button class="theme-toggle" id="themeToggle" aria-label="Alternar tema oscuro/claro">
            <i class="fas fa-sun"></i>
        </button>
        <div class="visualizer-container">
            <canvas id="visualizerCanvas"></canvas>
            <div id="sintonia-text">SINTONIA <span>102.5 FM</span></div>
        </div>

        <div id="rds-info">Información de la estación...</div>

        <div id="info-ticker">Cargando mensajes...</div>
        <div class="controls">
            <button class="control-button" id="playPauseButton" aria-label="Reproducir/Pausar">
                <i class="fas fa-play"></i>
            </button>
             <button class="control-button" id="toggleKickButton" aria-label="Mostrar/Ocultar transmisión en vivo">
                <i class="fas fa-video"></i>
            </button>
            <button class="control-button" id="newsLinkButton" aria-label="Ir a la web de noticias">
                <i class="fas fa-newspaper"></i>
            </button>
             <button class="sleep-timer-toggle-button" id="toggleSleepTimerButton" aria-label="Mostrar/Ocultar temporizador de apagado">
                <i class="fas fa-clock"></i>
            </button>
             <button class="weekly-scheduler-toggle-button" id="toggleWeeklySchedulerButton" aria-label="Mostrar/Ocultar programador semanal">
                 <i class="fas fa-calendar-days"></i>
             </button>
             <button class="control-button" id="shareButton" aria-label="Compartir aplicación">
                 <i class="fas fa-share-alt"></i>
             </button>
        </div>

        <div class="volume-control">
            <i class="fas fa-volume-down" id="volumeIcon"></i>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" aria-label="Control de volumen">
            </div>

        <div class="station-select">
            <label for="stations">Estación:</label>
            <select id="stations" aria-label="Seleccionar estación de radio">
                <option value="https://stream.radioservice.org/8046/stream">Radio Sintonia 102.5 - Opción 1</option>
                <option value="https://stream.zeno.fm/40x1zezb7nhvv">Radio Sintonia 102.5 - Opción 2</option>
                </select>
        </div>

        <div id="sleepTimerControls">
            <label for="sleepTimerMinutes">Apagado en (minutos):</label>
            <input type="number" id="sleepTimerMinutes" min="1" value="30" aria-label="Configurar temporizador de apagado">
            <button id="setSleepTimerButton" aria-label="Configurar temporizador"><i class="fas fa-clock"></i></button>
            <button id="cancelSleepTimerButton" style="display: none;" aria-label="Cancelar temporizador"><i class="fas fa-times"></i></button>
        </div>

         <div id="weeklySchedulerControls">
            <h3>Programar Encendido</h3>
            <div class="day-select">
                <label><input type="checkbox" name="schedule-day" value="1"> Lunes</label>
                <label><input type="checkbox" name="schedule-day" value="2"> Martes</label>
                <label><input type="checkbox" name="schedule-day" value="3"> Miércoles</label>
                <label><input type="checkbox" name="schedule-day" value="4"> Jueves</label>
                <label><input type="checkbox" name="schedule-day" value="5"> Viernes</label>
                <label><input type="checkbox" name="schedule-day" value="6"> Sábado</label>
                <label><input type="checkbox" name="schedule-day" value="0"> Domingo</label>
            </div>
            <div class="time-select">
                <label for="scheduleTime">Hora:</label>
                <input type="time" id="scheduleTime" value="07:00">
            </div>
            <button id="saveScheduleButton"> <i class="fas fa-save"></i> Guardar Programación</button>
            <button id="clearScheduleButton"> <i class="fas fa-times"></i> Limpiar Programación</button>
             <p style="font-size: 0.9em; color: rgba(255, 255, 255, 0.7); margin-top: 10px;">Nota: La programación solo funciona si la página está abierta en el navegador.</p>
        </div>

         <div class="kick-embed-container" id="kickEmbedContainer">
             <iframe src="https://player.kick.com/sintonia-tv" height="720" width="1280" frameborder="0" scrolling="no" allowfullscreen="true"></iframe>
        </div>

        <div class="toast-container" id="toastContainer"></div>

    </div>

    <p class="footer">Todos los derechos Reservados 2025 Sintonia</p>

    <script>
        console.log('Script started'); // Debugging: Script start marker

        // Wait for the DOM to be fully loaded before accessing elements
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and parsed'); // Debugging: DOM ready marker

            // --- Get Element References ---
            const playPauseButton = document.getElementById('playPauseButton');
            const playPauseIcon = playPauseButton ? playPauseButton.querySelector('i') : null; // Get icon element
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeIcon = document.getElementById('volumeIcon');
            const stationsSelect = document.getElementById('stations');
            const visualizerCanvas = document.getElementById('visualizerCanvas');
            const rdsInfo = document.getElementById('rds-info');
            const sleepTimerMinutesInput = document.getElementById('sleepTimerMinutes');
            const setSleepTimerButton = document.getElementById('setSleepTimerButton');
            const cancelSleepTimerButton = document.getElementById('cancelSleepTimerButton');
            const themeToggle = document.getElementById('themeToggle');
            const kickEmbedContainer = document.getElementById('kickEmbedContainer');
            const toggleKickButton = document.getElementById('toggleKickButton');
            const toastContainer = document.getElementById('toastContainer');
            const newsLinkButton = document.getElementById('newsLinkButton');
            const shareButton = document.getElementById('shareButton');
            const infoTicker = document.getElementById('info-ticker');

            // Sleep timer elements
            const toggleSleepTimerButton = document.getElementById('toggleSleepTimerButton');
            const sleepTimerControls = document.getElementById('sleepTimerControls');

            // Weekly scheduler elements
            const toggleWeeklySchedulerButton = document.getElementById('toggleWeeklySchedulerButton');
            const weeklySchedulerControls = document.getElementById('weeklySchedulerControls');
            const scheduleDayCheckboxes = document.querySelectorAll('#weeklySchedulerControls input[name="schedule-day"]');
            const scheduleTimeInput = document.getElementById('scheduleTime');
            const saveScheduleButton = document.getElementById('saveScheduleButton');
            const clearScheduleButton = document.getElementById('clearScheduleButton');

            // Check if essential elements are found
            if (!playPauseButton || !volumeSlider || !stationsSelect || !visualizerCanvas || !rdsInfo || !toastContainer || !infoTicker || !themeToggle || !playPauseIcon) {
                console.error('Essential elements not found. Player may not function correctly.');
                if (rdsInfo) rdsInfo.textContent = 'Error: Elementos esenciales del reproductor no encontrados.';
                 showToast('Error al iniciar el reproductor. Elementos no encontrados.', 'error');
                 return;
            }

            // Initialize variables after elements are confirmed to exist
            let audioContext;
            let audioSource;
            let analyser;
            let gainNode;
            let audio;
            let isPlaying = false;
            let animationFrameId;
            let sleepTimerTimeout;
            let isKickEmbedVisible = false;
            let isSleepTimerVisible = false;
            let isWeeklySchedulerVisible = false;
            let weeklySchedule = [];
            let scheduleCheckInterval;

            // --- Informational Titles for Ticker ---
            const informationalTitles = [
                "¡Bienvenido a Sintonia 102.5 FM!",
                "Música, noticias y entretenimiento 24/7.",
                "Síguenos en nuestras redes sociales.",
                "Descarga nuestra app móvil.",
                "Gracias por escucharnos."
            ];
            let currentTitleIndex = 0;
            const titleDisplayDuration = 5000;
            const titleFadeDuration = 500;

            // --- Audio Setup ---
            function initAudio() {
                console.log('initAudio called');
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    gainNode = audioContext.createGain();

                    analyser.fftSize = 2048;
                    const bufferLength = analyser.frequencyBinCount;
                    dataArray = new Uint8Array(bufferLength);
                }

                if (audio) {
                    audio.pause();
                    audio = null;
                }
                audio = new Audio(stationsSelect.value);
                audio.crossOrigin = 'anonymous';

                audioSource = audioContext.createMediaElementSource(audio);
                audioSource.connect(analyser);
                analyser.connect(gainNode);
                gainNode.connect(audioContext.destination);

                gainNode.gain.value = volumeSlider.value;

                audio.onplay = () => {
                    console.log('Audio onplay event');
                    isPlaying = true;
                    // Update play/pause button icon class
                    if (playPauseIcon) {
                        playPauseIcon.classList.remove('fa-play');
                        playPauseIcon.classList.add('fa-pause');
                    }
                    rdsInfo.textContent = 'Reproduciendo...';
                    showToast('Reproduciendo...');
                    requestAnimationFrame(drawVisualizer);
                };

                audio.onpause = () => {
                    console.log('Audio onpause event');
                    isPlaying = false;
                    // Update play/pause button icon class
                     if (playPauseIcon) {
                        playPauseIcon.classList.remove('fa-pause');
                        playPauseIcon.classList.add('fa-play');
                     }
                    rdsInfo.textContent = 'Pausado';
                    showToast('Pausado');
                    cancelAnimationFrame(animationFrameId);
                };

                audio.onerror = (e) => {
                    console.error('Audio error:', e);
                    rdsInfo.textContent = 'Error al cargar la estación';
                    showToast('Error de reproducción', 'error');
                    isPlaying = false;
                    if (playPauseIcon) {
                        playPauseIcon.classList.remove('fa-pause');
                        playPauseIcon.classList.add('fa-play');
                     }
                    cancelAnimationFrame(animationFrameId);
                };

                audio.onwaiting = () => {
                     console.log('Audio onwaiting event');
                     rdsInfo.textContent = 'Cargando...';
                     showToast('Cargando...');
                };

                 audio.onstalled = () => {
                     console.log('Audio onstalled event');
                     rdsInfo.textContent = 'Buffer vacío...';
                     showToast('Buffer vacío...');
                 };

                 audio.onplaying = () => {
                     console.log('Audio onplaying event');
                 };
            }

            // --- Play/Pause Control ---
            if (playPauseButton) {
                playPauseButton.addEventListener('click', () => {
                    console.log('Button click: playPauseButton');
                    if (!audio) {
                        initAudio();
                    }

                    if (audioContext.state === 'suspended') {
                         audioContext.resume();
                    }

                    if (isPlaying) {
                        audio.pause();
                    } else {
                        audio.play().catch(e => {
                            console.error("Playback failed:", e);
                            showToast('No se pudo iniciar la reproducción', 'error');
                             rdsInfo.textContent = 'Error de reproducción';
                        });
                    }
                });
            } else {
                console.error('Play/Pause button not found');
            }

            // --- Volume Control ---
            if (volumeSlider) {
                volumeSlider.addEventListener('input', () => {
                    console.log('Volume slider input:', volumeSlider.value);
                    if (gainNode) {
                        gainNode.gain.value = volumeSlider.value;
                        updateVolumeIcon(volumeSlider.value);
                    }
                     localStorage.setItem('sintonia_volume', volumeSlider.value);
                });

                 const savedVolume = localStorage.getItem('sintonia_volume');
                 if (savedVolume !== null) {
                     volumeSlider.value = savedVolume;
                     if (gainNode) {
                         gainNode.gain.value = savedVolume;
                     }
                 }
            } else {
                 console.error('Volume slider not found');
            }

            if (volumeIcon) {
                 volumeIcon.addEventListener('click', () => {
                    console.log('Button click: volumeIcon (Mute/Unmute)');
                    if (gainNode) {
                        if (gainNode.gain.value > 0) {
                            gainNode.gain.value = 0; // Mute
                            if (volumeSlider) volumeSlider.value = 0;
                            updateVolumeIcon(0);
                            showToast('Silenciado');
                        } else {
                            const previousVolume = localStorage.getItem('sintonia_volume') || 1;
                            gainNode.gain.value = previousVolume;
                             if (volumeSlider) volumeSlider.value = previousVolume;
                            updateVolumeIcon(previousVolume);
                            showToast('Sonido activado');
                        }
                         if (volumeSlider) localStorage.setItem('sintonia_volume', volumeSlider.value);
                    }
                });
                updateVolumeIcon(volumeSlider ? volumeSlider.value : 1);
            } else {
                console.error('Volume icon not found');
            }

            function updateVolumeIcon(volume) {
                if (volumeIcon) {
                    // Need to remove both fas and specific icon class
                    volumeIcon.classList.remove('fas', 'fa-volume-mute', 'fa-volume-down', 'fa-volume-up');
                    if (volume == 0) {
                        volumeIcon.classList.add('fas', 'fa-volume-mute');
                    } else if (volume < 0.5) {
                        volumeIcon.classList.add('fas', 'fa-volume-down');
                    } else {
                        volumeIcon.classList.add('fas', 'fa-volume-up');
                    }
                }
            }

            // --- Station Selection ---
            if (stationsSelect) {
                stationsSelect.addEventListener('change', () => {
                    console.log('Station select change:', stationsSelect.value);
                    initAudio();
                    if (isPlaying) {
                        audio.play().catch(e => {
                            console.error("Playback failed:", e);
                            showToast('No se pudo cambiar de estación', 'error');
                             rdsInfo.textContent = 'Error al cambiar de estación';
                        });
                    } else {
                         rdsInfo.textContent = 'Estación seleccionada: ' + stationsSelect.options[stationsSelect.selectedIndex].text;
                         showToast('Estación seleccionada');
                    }
                     localStorage.setItem('sintonia_last_station', stationsSelect.value);
                });

                 const lastStation = localStorage.getItem('sintonia_last_station');
                 if (lastStation) {
                     stationsSelect.value = lastStation;
                 }
            } else {
                 console.error('Stations select not found');
            }

            // --- Audio Visualization ---
            const canvasCtx = visualizerCanvas ? visualizerCanvas.getContext('2d') : null;
            let dataArray;

            function resizeCanvas() {
                if (visualizerCanvas) {
                    const container = visualizerCanvas.parentElement;
                    visualizerCanvas.width = container.clientWidth;
                    visualizerCanvas.height = container.clientHeight;
                }
            }

            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            function drawVisualizer() {
                if (!analyser || !canvasCtx || !isPlaying) {
                     cancelAnimationFrame(animationFrameId);
                     return;
                }

                animationFrameId = requestAnimationFrame(drawVisualizer);

                analyser.getByteFrequencyData(dataArray);

                canvasCtx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);

                const barWidth = (visualizerCanvas.width / dataArray.length) * 2.5;
                let barHeight;

                for (let i = 0; i < dataArray.length; i++) {
                    barHeight = dataArray[i];

                    const centerX = visualizerCanvas.width / 2;
                    const centerY = visualizerCanvas.height / 2;
                    const radius = Math.min(centerX, centerY) * 0.8;

                    const angle = (i / dataArray.length) * Math.PI * 2;

                    const startX = centerX + radius * Math.cos(angle);
                    const startY = centerY + radius * Math.sin(angle);
                    const endX = centerX + (radius + barHeight * 0.5) * Math.cos(angle);
                    const endY = centerY + (radius + barHeight * 0.5) * Math.sin(angle);

                    canvasCtx.strokeStyle = `hsl(${i / dataArray.length * 360}, 100%, 50%)`;
                    canvasCtx.lineWidth = barWidth * 0.8;
                    canvasCtx.beginPath();
                    canvasCtx.moveTo(startX, startY);
                    canvasCtx.lineTo(endX, endY);
                    canvasCtx.stroke();

                    if (barHeight > 150) {
                        canvasCtx.fillStyle = 'rgba(0, 123, 255, 0.2)';
                        canvasCtx.beginPath();
                        canvasCtx.arc(endX, endY, barHeight * 0.1, 0, Math.PI * 2);
                        canvasCtx.fill();
                    }
                }

                 const gradient = canvasCtx.createRadialGradient(
                     visualizerCanvas.width / 2, visualizerCanvas.height / 2, Math.min(visualizerCanvas.width, visualizerCanvas.height) * 0.4,
                     visualizerCanvas.width / 2, visualizerCanvas.height / 2, Math.min(visualizerCanvas.width, visualizerCanvas.height) * 0.5
                 );
                 gradient.addColorStop(0, 'rgba(0, 123, 255, 0.1)');
                 gradient.addColorStop(1, 'rgba(0, 123, 255, 0)');
                 canvasCtx.fillStyle = gradient;
                 canvasCtx.beginPath();
                 canvasCtx.arc(visualizerCanvas.width / 2, visualizerCanvas.height / 2, Math.min(visualizerCanvas.width, visualizerCanvas.height) * 0.5, 0, Math.PI * 2);
                 canvasCtx.fill();
            }

            // --- Sleep Timer Toggle ---
            if (toggleSleepTimerButton && sleepTimerControls) {
                toggleSleepTimerButton.addEventListener('click', () => {
                    console.log('Button click: toggleSleepTimerButton');
                    isSleepTimerVisible = !isSleepTimerVisible;
                    if (isSleepTimerVisible) {
                        sleepTimerControls.style.display = 'flex';
                        showToast('Mostrando temporizador de apagado.');
                    } else {
                        sleepTimerControls.style.display = 'none';
                        showToast('Ocultando temporizador de apagado.');
                    }
                });
            } else {
                 console.error('Sleep timer toggle button or controls not found');
            }

            // --- Sleep Timer Functionality ---
            if (setSleepTimerButton && sleepTimerMinutesInput && cancelSleepTimerButton) {
                setSleepTimerButton.addEventListener('click', () => {
                    console.log('Button click: setSleepTimerButton');
                    const minutes = parseInt(sleepTimerMinutesInput.value);
                    if (isNaN(minutes) || minutes <= 0) {
                        showToast('Por favor, introduce un número válido de minutos.', 'warning');
                        return;
                    }

                    if (sleepTimerTimeout) {
                        clearTimeout(sleepTimerTimeout);
                        console.log('Existing sleep timer cleared.');
                    }

                    const milliseconds = minutes * 60 * 1000;
                    console.log(`Setting sleep timer for ${minutes} minutes (${milliseconds} ms).`);
                    sleepTimerTimeout = setTimeout(() => {
                        console.log('Sleep timer timeout triggered.');
                        if (audio && isPlaying) {
                            console.log('Pausing audio due to sleep timer.');
                            audio.pause();
                            showToast('Temporizador de apagado activado.', 'info');
                        } else {
                             console.log('Sleep timer triggered, but audio was not playing or audio object invalid.');
                             if (!audio) console.error('Audio object invalid in sleep timer callback.');
                             if (!isPlaying) console.log('Audio was not playing when sleep timer triggered.');
                        }
                         sleepTimerTimeout = null;
                         cancelSleepTimerButton.style.display = 'none';
                    }, milliseconds);

                    showToast(`Temporizador de apagado configurado para ${minutes} minutos.`);
                    cancelSleepTimerButton.style.display = 'inline-flex';
                });

                 cancelSleepTimerButton.addEventListener('click', () => {
                     console.log('Button click: cancelSleepTimerButton');
                     if (sleepTimerTimeout) {
                         clearTimeout(sleepTimerTimeout);
                         sleepTimerTimeout = null;
                         console.log('Sleep timer cancelled by user.');
                         showToast('Temporizador de apagado cancelado.');
                         cancelSleepTimerButton.style.display = 'none';
                     } else {
                         console.log('Cancel sleep timer clicked, but no timer was active.');
                     }
                 });
            } else {
                console.error('Sleep timer buttons or input not found');
            }

            // --- Weekly Scheduler Toggle ---
            if (toggleWeeklySchedulerButton && weeklySchedulerControls) {
                toggleWeeklySchedulerButton.addEventListener('click', () => {
                    console.log('Button click: toggleWeeklySchedulerButton');
                    isWeeklySchedulerVisible = !isWeeklySchedulerVisible;
                    if (isWeeklySchedulerVisible) {
                        weeklySchedulerControls.style.display = 'flex';
                        showToast('Mostrando programador semanal.');
                    } else {
                        weeklySchedulerControls.style.display = 'none';
                        showToast('Ocultando programador semanal.');
                    }
                });
            } else {
                 console.error('Weekly scheduler toggle button or controls not found');
            }

            // --- Weekly Scheduler Functionality ---
            function loadSchedule() {
                console.log('loadSchedule called');
                const savedSchedule = localStorage.getItem('sintonia_schedule');
                if (savedSchedule) {
                    weeklySchedule = JSON.parse(savedSchedule);
                    console.log('Loaded schedule:', weeklySchedule);
                     if (scheduleDayCheckboxes) {
                        scheduleDayCheckboxes.forEach(checkbox => {
                            checkbox.checked = weeklySchedule.some(s => s.day === parseInt(checkbox.value));
                        });
                     }
                     if (scheduleTimeInput && weeklySchedule.length > 0) {
                         scheduleTimeInput.value = weeklySchedule[0].time;
                     } else if (scheduleTimeInput) {
                         scheduleTimeInput.value = '07:00';
                     }
                } else {
                    weeklySchedule = [];
                    console.log('No saved schedule found.');
                     if (scheduleTimeInput) {
                        scheduleTimeInput.value = '07:00';
                     }
                }
                 if (weeklySchedule.length > 0 && !scheduleCheckInterval) {
                     startScheduleCheck();
                 }
            }

            function saveSchedule() {
                console.log('Button click: saveScheduleButton');
                const selectedDays = Array.from(scheduleDayCheckboxes || [])
                    .filter(checkbox => checkbox.checked)
                    .map(checkbox => parseInt(checkbox.value));
                const selectedTime = scheduleTimeInput ? scheduleTimeInput.value : '07:00';

                if (selectedDays.length === 0) {
                    showToast('Selecciona al menos un día para programar.', 'warning');
                    console.warn('Save schedule clicked, but no days selected.');
                    return;
                }

                weeklySchedule = selectedDays.map(day => ({ day: day, time: selectedTime }));
                localStorage.setItem('sintonia_schedule', JSON.stringify(weeklySchedule));
                showToast('Programación guardada.');
                console.log('Schedule saved:', weeklySchedule);

                stopScheduleCheck();
                startScheduleCheck();
            }

            function clearSchedule() {
                console.log('Button click: clearScheduleButton');
                localStorage.removeItem('sintonia_schedule');
                weeklySchedule = [];
                if (scheduleDayCheckboxes) {
                    scheduleDayCheckboxes.forEach(checkbox => checkbox.checked = false);
                }
                 if (scheduleTimeInput) {
                    scheduleTimeInput.value = '07:00';
                 }
                showToast('Programación limpiada.');
                console.log('Schedule cleared.');
                stopScheduleCheck();
            }

            function startScheduleCheck() {
                 console.log('startScheduleCheck called');
                 if (weeklySchedule.length === 0) {
                     console.log('No schedule to check, interval not started.');
                     return;
                 }
                 if (scheduleCheckInterval) {
                     console.log('Schedule check interval already running.');
                     return;
                 }

                 scheduleCheckInterval = setInterval(() => {
                     console.log('Checking schedule...');
                     const now = new Date();
                     const currentDay = now.getDay();
                     const currentTime = now.toTimeString().slice(0, 5);
                     console.log(`Current Day: ${currentDay}, Current Time: ${currentTime}`);

                     const shouldPlay = weeklySchedule.some(schedule => {
                         console.log(`Comparing current ${currentDay}:${currentTime} with scheduled ${schedule.day}:${schedule.time}`);
                         return schedule.day === currentDay && currentTime >= schedule.time && currentTime < addMinutes(schedule.time, 1); // Check if current time is within the minute of the scheduled time
                     });

                     if (shouldPlay && !isPlaying) {
                         console.log(`Scheduled playback triggered for Day ${currentDay} at ${currentTime}`);
                         if (!audio) {
                            console.log('Initializing audio for scheduled playback.');
                            initAudio();
                         }
                         if (audioContext && audioContext.state === 'suspended') {
                             console.log('Resuming audio context for scheduled playback.');
                             audioContext.resume();
                         }
                          if (audio) {
                            console.log('Attempting audio play for scheduled playback.');
                            audio.play().catch(e => {
                                console.error("Scheduled playback failed:", e);
                                showToast('Error al iniciar la reproducción programada', 'error');
                            });
                             showToast('Iniciando reproducción programada.');
                          } else {
                              console.error('Audio object not initialized for scheduled playback');
                          }
                     } else {
                         console.log('No scheduled playback at this time or already playing.');
                     }
                 }, 60 * 1000); // Check every minute
                 console.log('Schedule check interval started.');
            }

            // Helper function to add minutes to a time string (HH:MM)
            function addMinutes(time, minsToAdd) {
                const [hours, minutes] = time.split(':').map(Number);
                const date = new Date();
                date.setHours(hours, minutes + minsToAdd, 0, 0);
                const newHours = date.getHours();
                const newMinutes = date.getMinutes();
                return `${String(newHours).padStart(2, '0')}:${String(newMinutes).padStart(2, '0')}`;
            }


            function stopScheduleCheck() {
                console.log('stopScheduleCheck called');
                if (scheduleCheckInterval) {
                    clearInterval(scheduleCheckInterval);
                    scheduleCheckInterval = null;
                    console.log('Schedule check stopped.');
                } else {
                     console.log('No schedule check interval was running.');
                }
            }

            if (saveScheduleButton) {
                saveScheduleButton.addEventListener('click', saveSchedule);
            } else {
                console.error('Save schedule button not found');
            }

            if (clearScheduleButton) {
                clearScheduleButton.addEventListener('click', clearSchedule);
            } else {
                console.error('Clear schedule button not found');
            }

            // --- Kick.com Embed Toggle ---
            if (toggleKickButton && kickEmbedContainer) {
                toggleKickButton.addEventListener('click', () => {
                    console.log('Button click: toggleKickButton');
                    isKickEmbedVisible = !isKickEmbedVisible;
                    if (isKickEmbedVisible) {
                        kickEmbedContainer.style.display = 'block';
                         showToast('Intentando cargar transmisión en vivo...');
                         setTimeout(() => {
                             try {
                                 const iframe = kickEmbedContainer.querySelector('iframe');
                                 if (iframe && iframe.contentWindow) {
                                     showToast('La transmisión en vivo podría estar bloqueada por el sitio de origen.', 'warning');
                                     showToast('Considera abrirla en una nueva pestaña si no carga.', 'info', 4000);
                                 } else {
                                      showToast('La transmisión en vivo podría estar bloqueada por el sitio de origen.', 'warning');
                                      showToast('Considera abrirla en una nueva pestaña si no carga.', 'info', 44000);
                                 }
                             } catch (e) {
                                  console.error('Cross-origin check error for Kick embed:', e);
                                  showToast('La transmisión en vivo podría estar bloqueada por el sitio de origen.', 'warning');
                                  showToast('Considera abrirla en una nueva pestaña si no carga.', 'info', 4000);
                             }
                         }, 2000);

                    } else {
                        kickEmbedContainer.style.display = 'none';
                         showToast('Ocultando transmisión en vivo.');
                    }
                });
            } else {
                console.error('Kick toggle button or container not found');
            }

            // --- News Link Button ---
            if (newsLinkButton) {
                newsLinkButton.addEventListener('click', () => {
                    console.log('Button click: newsLinkButton');
                    window.open('https://www.sintonia102.com/', '_blank');
                    showToast('Abriendo web de noticias...');
                });
            } else {
                console.error('News link button not found');
            }

            // --- Share Button ---
            if (shareButton) {
                shareButton.addEventListener('click', async () => {
                    console.log('Button click: shareButton');
                    const shareData = {
                        title: document.title,
                        text: 'Te invitamos a escuchar Sintonia 102.5, desde Monte Maíz, Cba. Argentina',
                        url: window.location.href
                    };

                    try {
                        if (navigator.share) {
                            console.log('Using Web Share API with data:', shareData);
                            await navigator.share(shareData);
                            console.log('Application shared successfully');
                            showToast('Aplicación compartida.');
                        } else {
                             if (navigator.clipboard && navigator.clipboard.writeText) {
                                const textToCopy = `${shareData.text}\n${shareData.url}`;
                                await navigator.clipboard.writeText(textToCopy);
                                console.log('Combined text and URL copied to clipboard:', textToCopy);
                                showToast('Mensaje y URL copiados al portapapeles.');
                             } else {
                                 console.warn('Clipboard API not available, could not copy URL and text.');
                                 showToast('No se pudo copiar el mensaje. Copia la dirección de la barra de direcciones.', 'warning');
                             }
                        }
                    } catch (err) {
                        console.error('Error sharing or copying:', err);
                        showToast('No se pudo compartir la aplicación.', 'error');
                    }
                });
            } else {
                console.error('Share button not found');
            }

            // --- History (Basic Placeholder) ---
            // History is handled by loading the last station on page load.

            // --- Theme Toggle ---
            if (themeToggle) {
                const handleThemeToggle = (event) => {
                     event.stopPropagation();
                     event.stopImmediatePropagation();

                    console.log('Theme toggle activated by:', event.type);
                    console.log('Event target:', event.target);

                    document.body.classList.toggle('light-theme');
                    console.log('Body classList after toggle:', document.body.classList);
                    const isLightTheme = document.body.classList.contains('light-theme');
                    const iconElement = themeToggle.querySelector('i');

                    if (iconElement) {
                         iconElement.classList.remove('fa-sun', 'fa-moon', 'fas', 'far', 'fad'); // Clean up existing classes
                         if (isLightTheme) {
                             iconElement.classList.add('fas', 'fa-moon'); // Light theme shows moon (to switch to dark)
                             showToast('Tema claro activado.');
                             localStorage.setItem('sintonia_theme', 'light');
                         } else {
                             iconElement.classList.add('fas', 'fa-sun'); // Dark theme shows sun (to switch to light)
                             showToast('Tema oscuro activado.');
                             localStorage.setItem('sintonia_theme', 'dark');
                         }
                    } else {
                         console.error('Theme toggle icon element not found during toggle.');
                    }
                };

                themeToggle.addEventListener('click', handleThemeToggle);
                themeToggle.addEventListener('touchend', handleThemeToggle);

                // Load saved theme on initial load and set initial icon
                const savedTheme = localStorage.getItem('sintonia_theme');
                const iconElement = themeToggle.querySelector('i');
                if (iconElement) {
                    iconElement.classList.remove('fa-sun', 'fa-moon', 'fas', 'far', 'fad'); // Clean up existing classes
                    if (savedTheme === 'light') {
                         document.body.classList.add('light-theme');
                         iconElement.classList.add('fas', 'fa-moon'); // Light theme shows moon
                    } else {
                         document.body.classList.remove('light-theme');
                         iconElement.classList.add('fas', 'fa-sun'); // Dark theme shows sun
                    }
                } else {
                    console.error('Theme toggle icon element not found on load.');
                }

            } else {
                console.error('Theme toggle button not found');
            }

            // --- Toast Notification System ---
            function showToast(message, type = 'info', duration = 3000) {
                console.log('Showing toast:', message);
                if (!toastContainer) {
                     console.error('Toast container not found');
                     return;
                }
                const toast = document.createElement('div');
                toast.classList.add('toast');
                if (type === 'error') {
                     toast.style.backgroundColor = 'rgba(220, 53, 69, 0.8)';
                } else if (type === 'warning') {
                     toast.style.backgroundColor = 'rgba(255, 193, 7, 0.8)';
                }
                toast.textContent = message;
                toastContainer.appendChild(toast);

                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);

                setTimeout(() => {
                    toast.classList.remove('show');
                    toast.addEventListener('transitionend', () => {
                        toast.remove();
                    });
                }, duration);
            }

            // --- Rotating Info Ticker Logic ---
            function updateInfoTicker() {
                if (!infoTicker) {
                    console.error('Info ticker element not found.');
                    return;
                }

                infoTicker.style.opacity = 0;

                setTimeout(() => {
                    infoTicker.textContent = informationalTitles[currentTitleIndex];
                    currentTitleIndex = (currentTitleIndex + 1) % informationalTitles.length;
                    infoTicker.style.opacity = 1;
                }, titleFadeDuration);
            }

            // --- Keyboard Shortcuts ---
            document.addEventListener('keydown', (event) => {
                if (event.code === 'Space' && event.target.tagName !== 'INPUT' && event.target.tagName !== 'SELECT') {
                    event.preventDefault();
                     if (playPauseButton) {
                        playPauseButton.click();
                     }
                }

                if (event.code === 'ArrowUp') {
                    event.preventDefault();
                     if (volumeSlider) {
                        volumeSlider.value = Math.min(1, parseFloat(volumeSlider.value) + 0.05);
                        volumeSlider.dispatchEvent(new Event('input'));
                     }
                }

                if (event.code === 'ArrowDown') {
                    event.preventDefault();
                     if (volumeSlider) {
                        volumeSlider.value = Math.max(0, parseFloat(volumeSlider.value) - 0.05);
                        volumeSlider.dispatchEvent(new Event('input'));
                     }
                }
            });

            // --- Initial Setup ---
            initAudio();
            loadSchedule();

            if (infoTicker) {
                 updateInfoTicker();
                 setInterval(updateInfoTicker, titleDisplayDuration);
            }

        }); // End of DOMContentLoaded

    </script>
</body>
</html>
